<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="telegram-web-app-title" content="ç®€å•ç‚¹å‡»æ¸¸æˆ">
  <meta name="telegram-web-app-platform" content="ios,android,web">
  <title>Telegram ç‚¹å‡»æ¸¸æˆ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      overflow: hidden;
    }

    .game-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    h1 {
      font-size: 28px;
      margin-bottom: 20px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .score-board {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
      background: rgba(255, 255, 255, 0.15);
      padding: 15px;
      border-radius: 15px;
    }

    .score-item {
      text-align: center;
    }

    .score-value {
      font-size: 24px;
      font-weight: bold;
      margin-top: 5px;
    }

    .game-button {
      background: linear-gradient(45deg, #ff6b6b, #ffa502);
      border: none;
      color: white;
      padding: 20px;
      font-size: 20px;
      border-radius: 50%;
      width: 150px;
      height: 150px;
      margin: 20px auto;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.2s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .game-button:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .game-button:active {
      transform: scale(0.95);
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }

    .control-button {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }

    .control-button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .user-info {
      margin-top: 20px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      font-size: 14px;
    }

    .hidden {
      display: none;
    }

    .pulse {
      animation: pulse 0.5s ease;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1);
      }
    }
  </style>
</head>

<body>
  <div class="game-container">
    <h1>ğŸ¯ ç‚¹å‡»æ¸¸æˆ</h1>

    <div class="score-board">
      <div class="score-item">
        <div>å½“å‰åˆ†æ•°</div>
        <div class="score-value" id="currentScore">0</div>
      </div>
      <div class="score-item">
        <div>æœ€é«˜åˆ†</div>
        <div class="score-value" id="bestScore">0</div>
      </div>
    </div>

    <button class="game-button" id="clickButton">ç‚¹å‡»æˆ‘!</button>

    <div class="controls">
      <button class="control-button" id="startButton">å¼€å§‹æ¸¸æˆ</button>
      <button class="control-button" id="resetButton">é‡ç½®</button>
      <button class="control-button" id="shareButton">åˆ†äº«</button>
    </div>

    <div class="user-info" id="userInfo">
      ç”¨æˆ·ä¿¡æ¯åŠ è½½ä¸­...
    </div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    // æ¸¸æˆçŠ¶æ€
    let score = 0;
    let bestScore = 0;
    let gameActive = false;

    // DOMå…ƒç´ 
    const currentScoreEl = document.getElementById('currentScore');
    const bestScoreEl = document.getElementById('bestScore');
    const clickButton = document.getElementById('clickButton');
    const startButton = document.getElementById('startButton');
    const resetButton = document.getElementById('resetButton');
    const shareButton = document.getElementById('shareButton');
    const userInfoEl = document.getElementById('userInfo');

    // åˆå§‹åŒ–Telegram WebApp
    function initTelegram() {
      if (window.Telegram && window.Telegram.WebApp) {
        const webApp = window.Telegram.WebApp;
        webApp.ready();
        webApp.expand();

        // è·å–ç”¨æˆ·ä¿¡æ¯
        if (webApp.initDataUnsafe && webApp.initDataUnsafe.user) {
          const user = webApp.initDataUnsafe.user;
          userInfoEl.innerHTML = `
                        æ¬¢è¿, ${user.first_name}${user.last_name ? ' ' + user.last_name : ''}!<br>
                        ç”¨æˆ·ID: ${user.id}
                    `;
        }

        // åŠ è½½æœ€é«˜åˆ†
        if (webApp.CloudStorage) {
          webApp.CloudStorage.getItem('best_score', (err, value) => {
            if (!err && value) {
              bestScore = parseInt(value) || 0;
              bestScoreEl.textContent = bestScore;
            }
          });
        }

        return true;
      } else {
        // å¼€å‘ç¯å¢ƒæ¨¡æ‹Ÿ
        userInfoEl.innerHTML = 'å¼€å‘æ¨¡å¼ - æ¨¡æ‹Ÿç”¨æˆ·ä¿¡æ¯<br>æ¬¢è¿, æµ‹è¯•ç”¨æˆ·!';
        return false;
      }
    }

    // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
    function updateScore() {
      currentScoreEl.textContent = score;
      if (score > bestScore) {
        bestScore = score;
        bestScoreEl.textContent = bestScore;
      }
    }

    // ä¿å­˜æœ€é«˜åˆ†
    function saveBestScore() {
      if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.CloudStorage) {
        window.Telegram.WebApp.CloudStorage.setItem('best_score', bestScore.toString(), (err) => {
          if (err) {
            console.log('ä¿å­˜åˆ†æ•°å¤±è´¥:', err);
          }
        });
      }
    }

    // ç‚¹å‡»äº‹ä»¶
    function handleClick() {
      if (!gameActive) return;

      score++;
      updateScore();

      // æ·»åŠ åŠ¨ç”»æ•ˆæœ
      clickButton.classList.add('pulse');
      setTimeout(() => {
        clickButton.classList.remove('pulse');
      }, 500);
    }

    // å¼€å§‹æ¸¸æˆ
    function startGame() {
      gameActive = true;
      score = 0;
      updateScore();
      startButton.textContent = 'æ¸¸æˆä¸­...';
      startButton.disabled = true;
    }

    // é‡ç½®æ¸¸æˆ
    function resetGame() {
      gameActive = false;
      score = 0;
      updateScore();
      startButton.textContent = 'å¼€å§‹æ¸¸æˆ';
      startButton.disabled = false;
    }

    // åˆ†äº«åŠŸèƒ½
    function shareScore() {
      if (window.Telegram && window.Telegram.WebApp) {
        const shareText = `æˆ‘åœ¨Telegramç‚¹å‡»æ¸¸æˆä¸­è·å¾—äº†${score}åˆ†! ä½ èƒ½è¶…è¿‡æˆ‘å—ï¼Ÿ`;
        window.Telegram.WebApp.shareToStory(shareText);
      } else {
        alert(`åˆ†äº«åˆ†æ•°: ${score}åˆ†!`);
      }
    }

    // äº‹ä»¶ç›‘å¬
    clickButton.addEventListener('click', handleClick);
    startButton.addEventListener('click', startGame);
    resetButton.addEventListener('click', resetGame);
    shareButton.addEventListener('click', shareScore);

    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
    window.addEventListener('load', () => {
      initTelegram();

      // é¡µé¢å…³é—­å‰ä¿å­˜åˆ†æ•°
      window.addEventListener('beforeunload', () => {
        if (score > bestScore) {
          saveBestScore();
        }
      });
    });
  </script>
</body>

</html>